<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>电话账单 - [[${roomNumber}]]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h2>📞 电话账单 - 房间 [[${roomNumber}]]</h2>

    <a th:href="@{/phone/new(roomNumber=${roomNumber})}" class="btn btn-primary mb-3">+ 新增通话</a>
    <a th:href="@{/phone/receipt(roomNumber=${roomNumber})}" class="btn btn-success mb-3 ms-2">🖨️ 打印话费收据</a>
    <a href="/" class="btn btn-secondary mb-3 ms-2">返回首页</a>

    <div class="alert alert-info" th:if="${total.compareTo(0) > 0}">
        未结账金额：¥[[${#numbers.formatDecimal(total, 1, 2)}]]
        <form th:action="@{/phone/settle}" method="post" style="display:inline;">
            <input type="hidden" name="roomNumber" th:value="${roomNumber}" />
            <button type="submit" class="btn btn-danger btn-sm ms-2"
                    onclick="return confirm('确认结账？')">结账</button>
        </form>
    </div>

    <table class="table table-bordered">
        <thead class="table-light">
        <tr>
            <th>拨打号码</th>
            <th>开始时间</th>
            <th>时长（分钟）</th>
            <th>费用</th>
            <th>状态</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="call : ${calls}">
            <td th:text="${call.phoneNumber}"></td>
            <td th:text="${#temporals.format(call.startTime, 'yyyy-MM-dd HH:mm')}"></td>
            <td th:text="${call.durationMinutes}"></td>
            <td>¥[[${#numbers.formatDecimal(call.cost, 1, 2)}]]</td>
            <td>
                <span th:if="${call.settled}" class="text-success">已结账</span>
                <span th:unless="${call.settled}" class="text-warning">未结账</span>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>