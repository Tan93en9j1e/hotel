<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>è´¦å•è¯¦æƒ… - [[${bill.roomNumber}]]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h2>ğŸ§¾ è´¦å•è¯¦æƒ…</h2>
    <a href="/billing/new" class="btn btn-secondary mb-3">â† æ–°å»ºè´¦å•</a>
    <a href="/" class="btn btn-outline-secondary mb-3 ms-2">ğŸ  é¦–é¡µ</a>

    <div class="alert alert-info">
        <strong>å®¢äººï¼š</strong> [[${bill.guestName}]] |
        <strong>æˆ¿é—´ï¼š</strong> [[${bill.roomNumber}]] |
        <strong>ç±»å‹ï¼š</strong> [[${bill.billType == 'individual' ? 'æ•£å®¢' : 'å›¢ä½“'}]]
    </div>

    <!-- æ·»åŠ æ¶ˆè´¹é¡¹ -->
    <div class="card mb-4">
        <div class="card-header">â• æ·»åŠ æ¶ˆè´¹</div>
        <div class="card-body">
            <form th:action="@{/billing/item}" method="post">
                <input type="hidden" name="billId" th:value="${bill.id}" />
                <div class="row g-2">
                    <div class="col-md-4">
                        <input type="text" name="description" class="form-control" placeholder="å¦‚ï¼šæˆ¿è´¹ã€æ´—è¡£è´¹" required />
                    </div>
                    <div class="col-md-2">
                        <input type="number" step="0.01" name="amount" class="form-control" placeholder="é‡‘é¢" required />
                    </div>
                    <div class="col-md-3">
                        <select name="category" class="form-select">
                            <option value="room">æˆ¿è´¹</option>
                            <option value="dining">é¤é¥®</option>
                            <option value="phone">ç”µè¯</option>
                            <option value="laundry">æ´—è¡£</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-outline-primary">æ·»åŠ </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- æ¶ˆè´¹æ˜ç»† -->
    <h5>ğŸ“ æ¶ˆè´¹æ˜ç»†</h5>
    <table class="table table-bordered">
        <thead>
        <tr><th>é¡¹ç›®</th><th>ç±»åˆ«</th><th>é‡‘é¢</th></tr>
        </thead>
        <tbody>
        <tr th:if="${#lists.isEmpty(bill.items)}">
            <td colspan="3" class="text-center text-muted">æš‚æ— æ¶ˆè´¹è®°å½•</td>
        </tr>
        <tr th:each="item : ${bill.items}">
            <td th:text="${item.description}"></td>
            <td th:text="${item.category}"></td>
            <td>Â¥[[${#numbers.formatDecimal(item.amount, 1, 2)}]]</td>
        </tr>
        </tbody>
        <tfoot>
        <tr class="table-primary">
            <td colspan="2"><strong>æ€»è®¡</strong></td>
            <td><strong>Â¥[[${#numbers.formatDecimal(bill.totalAmount, 1, 2)}]]</strong></td>
        </tr>
        </tfoot>
    </table>

    <!-- é¢„ä»˜æ¬¾ -->
    <div class="card mb-4">
        <div class="card-header">ğŸ’³ é¢„ä»˜æ¬¾ç®¡ç†</div>
        <div class="card-body">
            <p>å½“å‰é¢„ä»˜æ¬¾ï¼šÂ¥[[${#numbers.formatDecimal(bill.advancePayment, 1, 2)}]]</p>
            <form th:action="@{/billing/advance}" method="post" class="mt-2">
                <input type="hidden" name="billId" th:value="${bill.id}" />
                <div class="input-group">
                    <input type="number" step="0.01" name="payment" class="form-control" placeholder="è¾“å…¥é¢„ä»˜æ¬¾é‡‘é¢" required />
                    <button class="btn btn-success" type="submit">æ·»åŠ é¢„ä»˜æ¬¾</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç»“ç®—åŒº -->
    <div class="card">
        <div class="card-body">
            <h5>ç»“ç®—ä¿¡æ¯</h5>
            <p>æ€»æ¶ˆè´¹ï¼šÂ¥[[${#numbers.formatDecimal(bill.totalAmount, 1, 2)}]]</p>
            <p>å·²ä»˜é¢„ä»˜æ¬¾ï¼šÂ¥[[${#numbers.formatDecimal(bill.advancePayment, 1, 2)}]]</p>
            <p th:class="${bill.balance.compareTo(0) > 0 ? 'text-danger' : 'text-success'}">
                <strong>å¾…æ”¯ä»˜ï¼šÂ¥[[${#numbers.formatDecimal(bill.balance, 1, 2)}]]</strong>
            </p>

            <form th:action="@{/billing/settle}" method="post" class="mt-3">
                <input type="hidden" name="billId" th:value="${bill.id}" />
                <button type="submit" class="btn btn-success"
                        th:disabled="${bill.balance.compareTo(0) > 0}">
                    âœ… ä¸€æ¬¡æ€§ç¦»åº—ç»“è´¦å¹¶æ‰“å°æ”¶æ®
                </button>
                <div th:if="${bill.balance.compareTo(0) > 0}" class="mt-2 alert alert-warning">
                    âš ï¸ å®¢äººå°šæœ‰æ¬ æ¬¾ï¼Œè¯·å…ˆæ”¶å–ä½™æ¬¾æˆ–é€šçŸ¥å®¢äººï¼
                </div>
            </form>
        </div>
    </div>

</div>
</body>
</html>